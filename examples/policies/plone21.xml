<DeploymentPolicy id="plone21_example">

  <identification>

   <source 
       id="catalog"
       product="CMFDeployment" 
       factory="addIncrementalCatalogSource" />

    <!--
    <filter id="review_state"
            expr="python: memento.review_state in ('published','revision_draft', 'revision_submitted')" />
    -->

  </identification>

  <strategy id="default" />

  <registries>

    <registry view_path="/portal_css"
               deploy_path="/css"
               source_path="/portal_css" />

    <registry view_path="/portal_javascripts"
               deploy_path="/javascript"
               source_path="/portal_javascripts" />
   
  </registries>

  <resources>
    <resource id="image_extractor" 
	      product="CMFDeployment" 
	      factory="addSkinResourceRule" 
	      view_path=".*(?:png|gif|jpg)" 
	      deployment_path="/images" 
	      source_path="/"/>
  </resources>

  <organization cmf_mount="/" 
		fs_mount="*/examples/static/plone_2_1">

    <restricted id="Members" />
    <restricted id="content_type_registry" />
    <restricted id="acl_users" />
    <restricted id="mimetypes_registry" />
    <restricted id="archetype_tool" />
    <restricted id="uid_catalog" />
    <restricted id="reference_catalog" />

  </organization>

  <chain_user user="nobody" udb_path="special" /> 

  <mastering skin="Plone Default">

    <!-- executed in order and order is important -->

    <mime id="Site"
          filter_expr="python: object.portal_type == 'Plone Site'"
          ext_expr="string:index.html"
          view_method="string:index_html"
	  ghost="1"
          />

    <mime id="Folder"
          filter_expr="python: object.portal_type == 'Folder'"
          ext_expr="python: '%s/index.html'%object.getId()"
          view_method="python: object.defaultView()"
          />

<!-- Example of adding the plone root object to the policy
    <mime id="PloneSite"
          filter_expr="python: object.portal_type == 'Plone Site'"
	  ext_expr="python: 'index.html'"
	  view_method="string:index_html"
	  />
-->
    <mime id="IndexDocument"
          filter_expr="python: object.getId()=='index_html'"
          ext_expr="python: 'index.html'"
          view_method=""
          />

    <mime id="Document"
          filter_expr="python: object.portal_type == 'Document'"
          ext_expr="python: '%s.html'%object.getId()"
          view_method=""
          />

    <mime id="Image"
          filter_expr="python: object.portal_type == 'Image'"
          ext_expr="python: object.getId()"
          view_method=""
          />

    <mime id="Event"
          filter_expr="python: object.portal_type == 'Event'"
	  ext_expr="python: '%s.html'%object.getId()"
	  view_method=""
	  />


  </mastering>

</DeploymentPolicy>


