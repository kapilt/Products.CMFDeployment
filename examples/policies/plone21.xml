<DeploymentPolicy id="plone21_example">

  <identification>

   <source 
       id="catalog"
       product="CMFDeployment" 
       factory="addIncrementalCatalogSource" />

  </identification>

  <resources>

    <resource id="reg_portal_css"
	      product="CMFDeployment"
	      factory="addResourceRegistryRule"
	      view_path="/portal_css"
	      deployment_path="/css"
	      source_path="/portal_css"
	      />

    <resource id="reg_portal_javascripts"
	      product="CMFDeployment"
	      factory="addResourceRegistryRule"
	      view_path="/portal_javascripts"
	      deployment_path="/javascript"
	      source_path="/portal_javascripts"
	      />

    <resource id="image_extractor"
	      product="CMFDeployment"
	      factory="addSkinResourceRule"
	      view_path=".*(?:png|gif|jpg)"
	      deployment_path="/images"
	      source_path="/"
	      />

    <resource id="plone_images"
	      product="CMFDeployment"
	      factory="addDirectoryViewRule"
	      view_path="/plone_images"
	      deployment_path="/images"
	      source_path="/"
	      />

    <resource id="sitemap"
	      product="CMFDeployment"
	      factory="addResourceTemplateRule"
	      view_path="/sitemap"
	      deployment_path="/sitemap.html"
	      source_path="/sitemap"
	      />

    <resource id="search_form"
	      product="CMFDeployment"
	      factory="addResourceTemplateRule"
	      view_path="/search_form"
	      deployment_path="/search_form"
	      source_path="/search_form"
	      />

    <resource id="search"
	      product="CMFDeployment"
	      factory="addResourceTemplateRule"
	      view_path="/search"
	      deployment_path="/search"
	      source_path="/search"
	      />

    <resource id="iefixes_css"
	      product="CMFDeployment"
	      factory="addResourceTemplateRule"
	      view_path="/IEFixes.css"
	      deployment_path="/css/IEFixes.css"
	      source_path="/IEFixes.css"
	      />

    <resource id="favicon"
	      product="CMFDeployment"
	      factory="addResourceTemplateRule"
	      view_path="/favicon.ico"
	      deployment_path="/favicon.ico"
	      source_path="/favicon.ico"
	      />

  </resources>

  <organization cmf_mount="/" 
		fs_mount="*/examples/static/plone_2_1">

    <restricted id="Members" />
    <restricted id="content_type_registry" />
    <restricted id="acl_users" />
    <restricted id="mimetypes_registry" />
    <restricted id="archetype_tool" />
    <restricted id="uid_catalog" />
    <restricted id="reference_catalog" />

  </organization>

  <chain_user user="nobody" udb_path="special" /> 

  <mastering skin="Plone Default">

    <!-- executed in order and order is important -->

    <mime id="Site"
          filter_expr="python: object.portal_type == 'Plone Site'"
          ext_expr="string:index.html"
          view_method="string:index_html"
	  ghost="1"
          />

    <rule id="Folder"
	  product="CMFDeployment"
	  factory="addATContainerRule"
	  condition="python: object.portal_type == 'Folder'"
	  ext_expr="string:${object/getId}/index.html"
	  view_method="" />

    <mime id="IndexDocument"
          filter_expr="python: object.getId()=='index_html'"
          ext_expr="python: 'index.html'"
          view_method=""
          />

    <mime id="Document"
          filter_expr="python: object.portal_type == 'Document'"
          ext_expr="python: '%s.html'%object.getId()"
          view_method=""
          />

    <mime id="Image"
          filter_expr="python: object.portal_type == 'Image'"
          ext_expr="python: object.getId()"
          view_method=""
          />

    <mime id="Event"
          filter_expr="python: object.portal_type == 'Event'"
	  ext_expr="python: '%s.html'%object.getId()"
	  view_method=""
	  />


  </mastering>

</DeploymentPolicy>


